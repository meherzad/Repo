<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="css/jquery-ui-1.9.0.custom.min.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/chosen.css">
        <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="http://cloud.github.com/downloads/wycats/handlebars.js/handlebars-1.0.0.beta.6.js"></script>

        <script type="text/javascript" src="js/jquery-ui-1.8.24.custom.min.js"></script>
        <script type="text/javascript" src="js/chosen.jquery.js"></script>

    </head>
    <body>
        <header class="navbar">
            <div class="navbar-inner">
                <div class="container conatiner_support">
                    <div class="float_left">
                        <p id="logo">
                            <a href="http://localhost:8080/FinalDesign/index.html">Site
                                Logo</a> <span class="tagline">Free project hosting</span>
                        </p>
                    </div>
                    <div class="float_right">
                        <ul>
                            <li>
                                <ul class="ul_list" id="nav">
                                    <li><a id="lnkSignUp"> Sign Up</a></li>
                                    <li><a id="lnkSignIn">Sign In</a></li>
                                </ul>
                            </li>
                            <li><input id="searchSite" name="searchSite" maxlength="500"
                                       type="text" value="" autocomplete="off"
                                       title="Search all projects"
                                       style="color: rgb(170, 170, 170); font-style: italic;">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <div class="container conatiner_support">
            <div class="row" style="position: relative;">
                <div class="project_head">
                    <div class="project_head_image">
                        <a href="#" >
                            <img src="images/p1.jpg" />
                        </a>
                    </div>
                    <h1 class="project_title">
                        <div>
                            <a href="#">
                                Sample project 
                            </a>
                        </div>
                    </h1>
                </div>
            </div>
        </div>

        <div class ="conatiner_support container">
            <div class="row project_management_base" >
                <div class="card_base">
                    <div class="site_categories_left project_management_base">
                        <div class="cardNew"  style="text-align: center;">
                            <h2>To Do</h2>
                            <a id="todoAddTask" data-taskType="1">Add task</a>
                        </div>
                        <div id="todoTask"></div>
                        <script id="templateToDo" type="text/x-handlebars-template">
                            {{#each this}}

                            <div class="card" data-taskId="{{taskId}}" style="text-align: center;">
                                <h3>{{taskDescription}}</h3> 
                                <br>
                                {{deadLine}}
                            </div>
                            {{/each}}
                            </script>
                        </div>


                        <div class="site_categories_right project_management_base">
                            <div class="cardNew" style="text-align: center;">
                                <h2>Doing</h2>
                                <a id="todoAdfgdTask" data-taskType="2">Add task</a>
                            </div>
                            <div id="doingTask"></div>

                            <script id="templateDoing" type="text/x-handlebars-template">
                                {{#each this}}

                                <div class="card" data-taskId="{{taskId}}" style="text-align: center;">
                                    <h3>{{taskDescription}}</h3> 
                                    <br>
                                    {{deadLine}}
                                </div>
                                {{/each}}
                                </script>

                            </div>


                            <div class="site_categories_right project_management_base">
                                <div class="cardNew" style="text-align: center;">
                                    <h2>Done</h2>
                                    <a id="todoAffddTask" data-taskType="3">Add task</a>
                                </div>
                                <div id="doneTask"></div>

                                <script id="templateDone" type="text/x-handlebars-template">
                                    {{#each this}}

                                    <div class="card" data-taskId="{{taskId}}" style="text-align: center;">
                                        <h3>{{taskDescription}}</h3> 
                                        <br>
                                        {{deadLine}}
                                    </div>
                                    {{/each}}
                                    </script>

                                </div>
                            </div>                
                        </div>           
                    </div>
                    <div id="footer">
                        <div class="row">
                            <hr style="color:">
                            <ul class="ul_list">
                                <li class="list"></li>
                                <li class="list"><a href="#">Get Help</a></li>
                                <li class="list"><a href="#">Privacy Statement</a></li>
                                <li class="list"><a href="#">Terms of Use</a></li>
                                <li class="list"><a href="#">Code of Conduct</a></li>
                                <li class="list"><a href="#">Advertise With Us</a></li>

                            </ul>
                        </div>
                    </div>

                    <div id="dialog_form">
                        <script id="templateSubtask" type="text/x-handlebars-template">
                            {{#each this}}
                            <input type='checkbox' id="{{uId}}" checked="{{status}}"/><span> {{subTask}} </span><br>
                            {{/each}}
                            </script>
                            <div class="row">
                                <div id="display"></div>
                                <div class="" style="margin-left: 20px;">
                                    <label>Task </label>
                                    <input type="text" id="txtTaskName"/><br>
                                    <label style="float: right;">Members</label>    <label>DeadLine</label>    
                                    <input type="text" id="txtDeadLine"/>

                                    <select style="float:right;" size="1" id="txtMember" multiple>
                                        <option></option>
                                    </select>


                                    <label>Sub task</label>

                                    <div id="subtaskAdd">

                                    </div>
                                    <div id="subTaskButton">
                                        <input type="text" id="txtSubTask" style="display: none;"/>
                                        <a id="lblAddSubTask">Add</a>
                                        <input type="button" id="btnAddSubTask" value="Add" style="display:none;"/>
                                        <a style="display: none;" id="subTaskClose">X</a>
                                    </div>
                                </div>
                                <input type="hidden" id="requestType"/>
                            </div>
                        </div>
                        <input type="hidden" id="hiddenPhase" />
                        <input type="hidden" id="hiddenProjId" />

                        <script>
                            (function(){
                                var lblAddSubtask=$("#lblAddSubTask");
                                var subTaskClose=$("#subTaskClose");
                                var txtSubTask=$("#txtSubTask");
                                var btnAddSubTask=$("#btnAddSubTask");
                                var subtaskAdd=$("#subtaskAdd");
                                var members;
                                var memberList=$("#txtMember");
                                var selectedMember;  
                                $('#hiddenProjId').attr('value',1);
                           
                                function fillTask(){
                                    $.ajax({
                                        url:"ServletShowTask",
                                        data: {"projId":$("#hiddenProjId").attr('value'),
                                            "phaseId":1
                                        },
                                        type: "POST",
                                        dataType: 'json',
                                        success:function(dt){
                                            var temp=Handlebars.compile($("#templateToDo").html());
                                            $("#todoTask").html(temp(dt.task));
                                        },
                                        error:function(e){
                                            console.log(e)
                                        }
                                    });
                                    $.ajax({
                                        url:"ServletShowTask",
                                        data: {"projId":$("#hiddenProjId").attr('value'),
                                            "phaseId":2
                                        },
                                        type: "POST",
                                        dataType: 'json',
                                        success:function(dt){
                                            var temp=Handlebars.compile($("#templateDoing").html());
                                            $("#doingTask").html(temp(dt.task));
                                        },
                                        error:function(e){
                                            console.log(e)
                                        }
                                    });
                                    $.ajax({
                                        url:"ServletShowTask",
                                        data: {"projId":$("#hiddenProjId").attr('value'),
                                            "phaseId":3
                                        },
                                        type: "POST",
                                        dataType: 'json',
                                        success:function(dt){
                                            var temp=Handlebars.compile($("#templateDone").html());
                                            $("#doneTask").html(temp(dt.task));
                                        },
                                        error:function(e){
                                            console.log(e)
                                        }
                                    });
                                };
                                fillTask();
                            
                                $(".card").live('click',function(){
                                    // alert($(this).attr('data-taskId'));
                                    alert();
                                    $('#requestType').attr('value',2);
                                    $.ajax({
                                        url:"ServletAddSubtask",
                                        data: {
                                            "type":3,
                                            "taskId":$(this).attr('data-taskId')
                                        },
                                        type: "POST",
                                        success:function(result){
                                            
                                        } 
                                    })
                                    $.ajax({
                                        url:"ServletGetUser",
                                        data: {"projId":$("#hiddenProjId").attr('value')},
                                        type: "POST",
                                        success:function(result){
                          ',                  $(memberList).html('<option></option>');
                                            $.ajax({
                                                url:"ServletGetUser",
                                                data: {"projId":$("#hiddenProjId").attr('value')},
                                                type: "POST",
                                                success:function(result){
                                                    jQuery.each(result, function(index, value) {
                                                        jQuery.each(value, function(index, val){
                                                            $(memberList).append('<option value='+val.userId+' id="select'+val.userId+'">'+val.nick+'</option>');
                                                        });
                                                    });
                                                    $('#txtMember').chosen().change(function(e){
                                                        selectedMember='';
                                                        var selected=$("#txtMember").children("option").filter(":selected");
                                                        $.each(selected, function(){
                                                            selectedMember+=$(this).val()+','+$(this).text()+'---'; 
                                                        });
                                  
                                                    });
                                                    
                                                }
                                            }); 
                            
                                            jQuery.each(result, function(index, value) {
                                                jQuery.each(value, function(index, val){
                                                    var id = '#select'+val.userId;
                                                    $(id).attr('selected','selected');
                                                    console.log(id+ '  '+ $(id).attr('selected'));
                                                });
                                            });
                                            //$('.chzn-container').remove();
                                            $("#txtMember").trigger("liszt:updated");
                                        }
                                    });
                                
                                    $("#dialog_form").dialog("open");
                                });
                            
                                $.ajax({
                                    url:"ServletGetUser",
                                    data: {"projId":$("#hiddenProjId").attr('value')},
                                    type: "POST",
                                    success:function(result){
                                        jQuery.each(result, function(index, value) {
                                            jQuery.each(value, function(index, val){
                                                $(memberList).append('<option value='+val.userId+' id="select'+val.userId+'">'+val.nick+'</option>');
                                            });
                                        });
                                        $('#txtMember').chosen().change(function(e){
                                            selectedMember='';
                                            var selected=$("#txtMember").children("option").filter(":selected");
                                            $.each(selected, function(){
                                                selectedMember+=$(this).val()+','+$(this).text()+'---'; 
                                            });
                                  
                                        });
                                    }
                                }); 
                            
                                $("#dialog_form").dialog(
                                {
                                    autoOpen : false,
                                    height : 600,
                                    width : 500,
                                    modal : true,
                                    buttons : {
                                        "Add Task" : function() {
                                            var requestType=$("#requestType").attr('value');
                                        
                                            $.ajaxSetup({
                                                url:"ServletAddSubtask",
                                                data: {"type":2, 
                                                    "taskName": $("#txtTaskName").attr('value'),
                                                    "deadLine": $("#txtDeadLine").attr('value'),
                                                    "phaseId":  $("#hiddenPhase").attr('value'),
                                                    "projId": $("#hiddenProjId").attr('value'),
                                                    "members": selectedMember
                                                },
                                                type: "POST",
                                                success:function(result){
                                                    //alert(result.status);
                                                    var taskId=result.taskId;
                                                    if (result.status.toString()=='Fail'){
                                                        $('#display').html('Fail');
                                                        return;
                                                    }
                                                    $("#dialog_form").dialog("close");
                                                    fillTask();
                                                }
                                
                                            }); 
                                            $.ajax();
                                        },
                                        Cancel : function() {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                                $(".cardNew a").click(function() {
                                    var  type=$(this).attr('data-taskType');
                                    $("#hiddenPhase").attr('value',type);
                                    $("#requestType").attr('value',1);
                                    $("#dialog_form").dialog("open");
                        
                                });
                                $("#btnAddSubTask").click(function(){
                                    var taskName=$(txtSubTask).attr('value');
                                    $(subtaskAdd).append("<input type='checkbox' /><span>"+ taskName + "</span><br>");
                                    $(txtSubTask).attr('value','');
                                    $(subTaskClose).css('display','none');
                                    $(lblAddSubTask).css('display','inline');
                                    $(txtSubTask).css('display','none');
                                    $(btnAddSubTask).css('display','none');
                                    $.ajaxSetup({
                                        url:"ServletAddSubtask",
                                        data: {
                                            "type":1, 
                                            "subTask":taskName,
                                            "projId":$("#hiddenProjId").attr('value')
                                        },
                                        type: "POST",
                                        success:function(result){
                                            $("#diplay").html(result.status);
                                        }
                                    }); 
                                    $.ajax();

                                });
                                $("#lblAddSubTask").click(function(){
                                    $(lblAddSubTask).css('display','none');
                                    $(txtSubTask).css('display','inline').focus();
                                    $(btnAddSubTask).css('display','inline');
                                    $(subTaskClose).css('display','inline');
                                });
                                $("#subTaskClose").click(function(){
                                    $(subTaskClose).css('display','none');
                                    $(txtSubTask).attr('value','');
                                    $(lblAddSubTask).css('display','inline');
                                    $(txtSubTask).css('display','none');
                                    $(btnAddSubTask).css('display','none');
                                    $("#requestType").attr('value','');
                                });
                                $("#txtDeadLine").datepicker();
                
                            })();
                        </script>
                    </body>
                </html>
