<!DOCTYPE html>
<html>
    <head>
        <meta charset="ISO-8859-1">
        <title>Insert title here</title>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/style 2.css">
        <link rel="stylesheet" href="css/paging.css">
        <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="js/highcharts.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script> 
        <script src="js/highcharts-more.js"></script>
        <script src="js/exporting.js"></script>
        <script type="text/javascript" src="js/quickpager.jquery.js"></script>
        <script type="text/javascript" src="http://cloud.github.com/downloads/wycats/handlebars.js/handlebars-1.0.0.beta.6.js"></script>

    </head>
    <body>
        <!--Add Header Here------------------->

        <div class="container conatiner_support">
            <div class="row">
                <ul id="project_menu">
                    <li>
                        <a class="menuLink" href="ServletProjectHome?projId=" >Home</a>
                    </li>
                    <li id="projDash">
                        <a class="menuLink" href="frmProjectDashboard.html?projId=" >Project Management</a>
                    </li>
                    <li>
                        <a class="menuLink" href="projectDownload.html?projId=" >Downloads</a>
                    </li>
                    <li>
                        <a class="menuLink" href="ServletViewDocumentation?projId=" >Documentation</a>
                    </li>
                    <li>
                        <a class="menuLink" href="ServletGetBugs?projId=" >Bug Tracking</a>
                    </li>
                    <li>
                        <a class="menuLink" href="ServletDiscussionHead?projId=" >Discussion</a>
                    </li>
                    <li>
                        <a class="menuLink" href="ProjectPeople.jsp?projId=" >People</a>
                    </li>
                    <li>
                        <a class="menuLink" href="ProjectLicense.html?projId=" >License</a>
                    </li>
                </ul>
            </div>
        </div>

        <div id="wrap">
            <br><br><br><br><br><br>
            Download Analysis

            <div id="ProjectMembers" class="top_border">
                <div style="float: left" style="width: 300px; height: 300px; margin: 0 auto">
                    <div id="project_detail"></div><br>
                    <div id="reviewdiv" style="float: left"></div>
                </div><br>
                <div style="float: right">
                    <div id="container" style="width: 300px; height: 300px; margin: 0 auto"></div>
                </div>
            </div>





            <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
                    <h3 id="myModalLabel" style="color: #6A747E;"><center>Review Project</center></h3>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" method="post" action="">
                        <div class="control-group">
                            <label class="loginLabel" >Rating</label>
                            <div class="controls">
                                <select id="rateing" name="rateing">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>

                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="loginLabel">Review</label>
                            <div class="controls">
                                <textarea id="review_desc"  maxlength="400" name="review_desc" placeholder="Write a review...."></textarea>
                                <p>Maximum length 400 Characters</p>
                                <div id="emessage"> </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="controls">

                                <button type="button" class="btn" id="btnLogIn" class="close" data-dismiss="modal">Review</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div id="Reviews">

                <ul id="ReviewList" class="paging">

                </ul>
            </div>
            <script id="reviewscript" type="text/x-handlebars-template">
                {{#each this}}
                <li>  </li>
                <div class="ReviewListItem">
                    Rated:<b>{{rate}}</b>/5<br>
                    {{review}}<br>
                    by <a href="profile.jsp?userId={{userId}}" class="bold">{{username}}</a>&nbsp;On {{time}}<br>

                </div>

                {{/each}}
            </script>
            <script id="projectde" type="text/x-handlebars-template">
                {{#each this}}
                <h1 class="page_tilte">{{projName}}</h1><br>
                <table id="release" cellspacing="10" cellpadding="10" border="0" style="border :1px solid #c0c0c0; margin-top: 10px;">
                    <tr><div class="metadataRow"><td valign="top" style="border-right: 1px solid #c0c0c0;"> <span class="metadataItemHeader">Rated:</span>&nbsp;&nbsp;{{Rating}}&nbsp;/5</td></div></tr>
                    <tr><div class="metadataRow"><td valign="top" style="border-right: 1px solid #c0c0c0;"> <span class="metadataItemHeader">Downloads:</span>&nbsp;&nbsp;{{downloads}}</td></div></tr>
                    <tr><div class="metadataRow"><td valign="top" style="border-right: 1px solid #c0c0c0;"> <span class="metadataItemHeader"> Reviewed:</span>&nbsp;&nbsp;{{Reviewed}}&nbsp;reviews</td></div></tr>
                </table>


                {{/each}}
            </script>
            <script type="text/javascript">
                
                
                $(function(){
                    function getParameterByName(name) {
                        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                        var regexS = "[\\?&]" + name + "=([^&#]*)";
                        var regex = new RegExp(regexS);
                        var results = regex.exec(window.location.search);
                        if (results == null)
                            return "";
                        else
                            return decodeURIComponent(results[1].replace(/\+/g, " "));
                    }
                    var projId=getParameterByName("projId");
                    $.each($('a.menuLink'), function(key,val){
                        var link=$(val).attr('href');
                        link=link+projId;
                        $(val).attr('href',link);
                    });
                    $.ajax({
                        url:'ServletCheckUserType',
                        data:{
                            projId:projId
                        },
                        type:'post',
                        success:function(dt){
                            if (dt.status!='true'){
                                $("#projDash").css('display','none');
                            }
                        },
                        error:function(){
                            console.log('error');
                        }
                    });
                    function requestData() {
                        $.ajax({
                            url:'ServletGetDownloadData',
                            data:{
                                'projId':projId
                            },
                            type:'post',
                            success:function(dt){
                                console.log(dt.value);
                                //                        chart.series[0].data=dt.value;
                                chart.series[0].addPoint(dt.value, true, 0);
                                console.log("hello");
                                console.log(chart.series[0].d);
                                chart.redraw();
                            },
                            error:function(){
                            
                            }
                        });
                    }
                    $.ajax({
                        url:"Servletreview",
                        type:"POST",
                        data:{
                            type:"loadreview",
                            projId:projId
                        },       
                        success:function(dt){
                            console.log("-------");
                            console.log(dt);
                            var temp=Handlebars.compile($("#reviewscript").html());
                            $("#ReviewList").html(temp(dt.reviews));
                            var temp1=Handlebars.compile($("#projectde").html());
                            $("#project_detail").html(temp1(dt.project));
                            $("ul.paging").quickPager({
                                pageSize:"7", 
                                currentPage:"1", 
                                pagerLocation:"before"
                            });
                            if(dt.checkUser!="login"){
                                $("#reviewdiv").html('<a id="lnkSignIn" href="index.jsp" >Review</a>');

                            }
                            
                            else{

                                $("#reviewdiv").html('<a id="lnkSignIn" href="#myModal" data-toggle="modal">Review</a>');
                            }
                        },
                        error:function(){
                            alert('error');

                        }
                    });
                    
                    var chart = new Highcharts.Chart({
	    
                        chart: {
                            renderTo: 'container',
                            type: 'gauge',
                            plotBackgroundColor: null,
                            plotBackgroundImage: null,
                            plotBorderWidth: 0,
                            plotShadow: false,
                            events: {
                                load: requestData()
                            }
                        },
	        
                        title: {
                            text: 'Download Meter'
                        },
	        
                        pane: {
                            startAngle: -150,
                            endAngle: 150,
                            background: [{
                                    backgroundColor: {
                                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                                        stops: [
                                            [0, '#FFF'],
                                            [1, '#333']
                                        ]
                                    },
                                    borderWidth: 0,
                                    outerRadius: '109%'
                                }, {
                                    backgroundColor: {
                                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
                                        stops: [
                                            [0, '#333'],
                                            [1, '#FFF']
                                        ]
                                    },
                                    borderWidth: 1,
                                    outerRadius: '107%'
                                }, {
                                    // default background
                                }, {
                                    backgroundColor: '#DDD',
                                    borderWidth: 0,
                                    outerRadius: '105%',
                                    innerRadius: '103%'
                                }]
                        },
	           
                        // the value axis
                        yAxis: {
                            min: 0,
                            max: 200,
	            
                            minorTickInterval: 'auto',
                            minorTickWidth: 1,
                            minorTickLength: 10,
                            minorTickPosition: 'inside',
                            minorTickColor: '#666',
	    
                            tickPixelInterval: 30,
                            tickWidth: 2,
                            tickPosition: 'inside',
                            tickLength: 10,
                            tickColor: '#666',
                            labels: {
                                step: 2,
                                rotation: 'auto'
                            },
                            title: {
                                text: 'Download'
                            },
                            plotBands: [{
                                    from: 0,
                                    to: 120,
                                    color: '#55BF3B' // green
                                }, {
                                    from: 120,
                                    to: 160,
                                    color: '#DDDF0D' // yellow
                                }, {
                                    from: 160,
                                    to: 200,
                                    color: '#DF5353' // red
                                }]        
                        },
	    
                        series: [{
                                name: 'Speed',
                                data: [],
                                tooltip: {
                                    valueSuffix: 'Download'
                                }
                            }]
                    });


                    $("#btnLogIn").click(function(){
                        var e = document.getElementById("rateing");
                        var strSel =e.options[e.selectedIndex].value;
                        var rev=$("#review_desc").val();
                        //                        alert(rev);
                        if(rev)
                        {
                            $("#emessage").html("");

                            $.ajax({
                                url:"Servletreview",
                                type:"POST",
                                data:{
                                    type:"review",
                                    drop:strSel,
                                    review:rev,
                                    projId:projId
                                },       
                                success:function(dt){
                                    $.ajax({
                                        url:"review",
                                        type:"POST",
                                        data:{
                                            type:"loadreview",
                                            projId:projId
                                        },       
                                        success:function(dt){
                                            console.log(dt.reviews);
                                            $("#emessage").html("");
                                            var temp=Handlebars.compile($("#reviewscript").html());
                                            $("#ReviewList").html(temp(dt.reviews));
                                        }
                                    });
                                }
                            });
                        }else
                        {
                            $("#emessage").html("Please Write Review!!!");
                        }
                    });
                    
	    
                });
            </script>
        </div>
    </body>  
</html>